package com;

import org.assertj.core.api.Assertions;
import org.junit.jupiter.api.AfterEach;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.extension.ExtendWith;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.test.context.junit.jupiter.SpringExtension;

import com.controller.PetController;
import com.dao.PetRepository;
import com.pojo.Pet;

@SpringBootTest
@ExtendWith(value = SpringExtension.class)
class Petkart3ApplicationTests {
	@Autowired
	private PetRepository petRepo;
	@Autowired
	private PetController petController;

	@BeforeEach
	public void setUp() {
		Pet pet = new Pet();
		pet.setPetDescription("ramya");
		pet.setPetType("ramyagajawada@gmail.com");
		pet.setPetId("5");
		pet.setPetPrice(12);
		pet.setPetName("ramya");
		
		petRepo.save(pet);
	}

	@AfterEach
	public void cleanUp() {
		petRepo.deleteAll();
	}

	@Test
	void shouldSavePet() {
		// arrange
		Pet user = new Pet();
		user.setUserPwd("ramya123");
		user.setEmail("ramya@gmail.com");
		user.setPetId("6");
		user.setUserId("123");
		user.setUserName("sushmitha");
		user.setConfirmed("confirmed1");

//act
		User savedUser = petController.saveUser(user);
		// assert
		Assertions.assertThat(savedUser.getConfirmed()).isEqualTo(user.getConfirmed());
		Assertions.assertThat(savedUser.getEmail()).isEqualTo(user.getEmail());
		Assertions.assertThat(savedUser.getPetId()).isEqualTo(user.getPetId());
		Assertions.assertThat(savedUser.getUserId()).isEqualTo(user.getUserId());
		Assertions.assertThat(savedUser.getUserName()).isEqualTo(user.getUserName());
		Assertions.assertThat(savedUser.getUserPwd()).isEqualTo(user.getUserPwd());
	}

	@Test
	void shouldUpdateSavedUser() {
		// arrange
		User user = new User();
		user.setEmail("newEmail@gmail.com");
		user.setUserPwd("ramya");
		user.setPetId("5");
		user.setUserId("12");
		user.setUserName("ramya");
		user.setConfirmed("confirmed");
//act
		User updatedUser = petController.updateUser(user, "12");
		// assert
		Assertions.assertThat(updatedUser.getEmail()).isEqualTo(user.getEmail());

	}

	@Test
	void shouldDeleteUser() {
		// arrange
		// act
		boolean deletedUser = petController.deleteUser("12");
		// assert
		Assertions.assertThat(deletedUser).isTrue();
		Assertions.assertThat(petRepo.findAll()).hasSize(0);

	}
	@Test
	void shouldRetriveUser() {
		//act
		User foundUser=petController.findOneUser("12");
		//assert
		Assertions.assertThat(foundUser).isNotNull();
		
	}


	

}
